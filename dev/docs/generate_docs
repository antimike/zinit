#!/bin/zsh -f
# SUMMARY:
#       Wrapper around help2man (for manpage) and _arguments -- (for completion)
#
# EXPLANATION:
#       This function is designed to help make the use of poorly- or irregularly-documented programs which support something like the standard GNU options conventions more convenient.  It serves two basic purposes:
#               1. to generate zsh completion functions for such commands, and
#               2. to generate manpages for such commands.
#
#       In both capacities, this function relies heavily on external tools:
#               * Manpages are, by default, generated by piping the output of a specified command to the tool `help2man`; and
#               * zsh completions are generated using the `_arguments --` form of the _arguments completion function (see `man zshcompsys` for clarification).
#       More granular control over the way in which manpages are generated is possible using options (see below).  It is also possible to disable one or the other of the two primary output-types.
#
# PARAMS:
#       $1: Command to complete / document
#
# OPTIONS:
#       -h OPTNAME              Option used to generate docs and completions (default: --help)
#       -v OPTNAME              Option used to generate version number by help2man (default: --version)
#       -c,--comp-with SUBCMD   Subcommand to append to main command to generate completions
#       -C,--comp-from CMD      Command to generate completions.  Unlike with -c/--comp-with, the main command is not prepended
#       -m,--man-with SUBCMD    Subcommand to append to main command to generate docs (manpage)
#       -M,--man-from CMD       Command to generate text which will be formatted as the command's manpage
#       --man-convert CMD       Command to which the output of the 'man-from' command should be piped to generate documentation
#       --makeman CMD           Bypass 'man-from' command altogether, instead specifying an independent command which will be used to generate a manpage

zmodload zsh/zutil

local -A opts=(
        [-h]=--help
        [-v]=--version
)
zparseopts -D -E -M -K -A opts -- h: v: \
        c: -comp-with:=c \
        C: -comp-from:=C \
        m: -man-with:=m \
        M: -man-from:=M \
        -man-convert: \
        -makeman:

local cmd=$1

if (( ${+opts[-makeman]} )); then
        # --makeman was specified
        :
elif (( ${+opts[-man-convert]} )); then
        # --man-convert: pipe mancmd to specified converter
        :
elif (( ${+opts[-M]} )); then
        # --man-from: specify mancmd
fi
